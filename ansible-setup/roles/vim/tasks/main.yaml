---

- name: Install VIM
  become: true
  dnf:
    name: "{{ item }}"
    state: latest
  with_items:
    - vim
    - gvim
  when: ansible_os_family == "RedHat"

- name: Install VIM
  become: true
  pacman:
    name: "{{ item }}"
    state: latest
  with_items:
    - vim
    - gvim
  when: ansible_os_family == "Archlinux"

- name: Install MacVIM
  homebrew:
    formula: macvim
    state: latest
  when: ansible_os_family == "Darwin"

- name: Install VIM
  homebrew:
    formula: vim
    install_options: HEAD
    state: latest
  when: ansible_os_family == "Darwin"

- name: Remove default vim dir
  file:
    dest: "{{ ansible_user_dir }}/.vim"
    state: absent

- name: Link vim directory
  file:
    src: "{{ dotfiles_dir }}/vim"
    dest: "{{ ansible_user_dir }}/.vim"
    state: link
    force: yes

- name: Verify vim-plug is in autoload directory
  file:
    dest: "{{ dotfiles_dir }}/vim/autoload/plug.vim"
    state: file

- name: Install plugins
  command: vim -c ":PlugInstall" -c q -c q -c q
